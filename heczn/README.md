# HEC-RAS 中文界面覆盖层

这是一个为 macOS 设计的中文界面覆盖层工具，专门用于为运行在 Parallels 虚拟机中的 HEC-RAS 软件提供中文界面标注。

## 功能特点

- 🖥️ **透明覆盖层**：无边框透明窗口，始终显示在最顶层
- 🖱️ **鼠标穿透**：鼠标事件完全穿透到底层 HEC-RAS 界面
- 📝 **配置驱动**：所有中文标签由外部 JSON 配置文件控制
- 🔄 **热更新**：修改配置文件后自动刷新显示，无需重启
- ⌨️ **快捷退出**：Ctrl+Shift+Q 安全退出覆盖层
- 🎯 **精确定位**：提供鼠标坐标辅助工具，方便确定界面元素位置
- 🎮 **GUI控制面板**：图形化界面，便于操作和管理

## 安装依赖

```bash
pip install -r requirements.txt
# macOS: 安装 tesseract（用于 OCR）
# brew install tesseract
```

## 使用方法

### 方式一：命令行控制工具（推荐）

最简单且稳定的使用方式是命令行控制工具：

```bash
python cli_control.py
```

或使用启动脚本：
```bash
./run_cli.sh
```

控制工具提供以下功能：
- **一键启动/停止**覆盖层和坐标显示器
- **实时状态监控**查看程序运行状态
- **配置信息查看**显示标签配置详情
- **配置文件编辑**一键打开配置文件
- **交互式菜单**清晰的操作界面

### 方式二：GUI控制面板

如果您的环境支持图形界面，可以使用GUI控制面板：

```bash
python control_panel.py
```

或使用启动脚本：
```bash
./run_panel.sh
```

GUI控制面板提供：
- **图形化界面**直观的操作体验
- **实时状态监控**查看程序运行状态
- **日志显示**查看操作记录

### 方式二：命令行操作

如果您喜欢命令行操作，也可以直接运行各个程序：

### 1. 确定界面元素坐标

首先运行鼠标坐标显示器来获取 HEC-RAS 界面元素的屏幕坐标：

```bash
python mouse_pos_macos.py
```

鼠标移动时，窗口会实时显示当前坐标 `(x, y)`。

### 2. 配置中文标签

编辑 `labels.json` 文件，为每个界面元素添加中文标注：

```json
{
  "rect": [10, 5, 80, 25],
  "text": "文件",
  "font_size": 11,
  "bg_alpha": 0.8,
  "corner_radius": 3,
  "padding": 4
}
```

**参数说明：**
- `rect`: `[x, y, width, height]` 屏幕坐标和尺寸
- `text`: 中文标注文本
- `font_size`: 字体大小（可选，默认 12）
- `bg_alpha`: 背景透明度 0.0-1.0（可选，默认 0.7）
- `corner_radius`: 圆角半径（可选，默认 5）
- `padding`: 内边距（可选，默认 5）

### 3. 启动覆盖层

```bash
python overlay_macos.py
```

覆盖层启动后会显示在屏幕最顶层，所有鼠标操作都会穿透到底层的 HEC-RAS 界面。

### 4. 热更新配置

修改 `labels.json` 文件后，覆盖层会自动检测文件变化并刷新显示，无需重启程序。

## 配置文件格式

```json
{
  "description": "HEC-RAS 中文界面覆盖层配置",
  "version": "1.0.0",
  "labels": [
    {
      "rect": [x, y, width, height],
      "text": "中文标注",
      "font_size": 12,
      "bg_alpha": 0.7,
      "corner_radius": 5,
      "padding": 5
    }
  ]
}
```

## 快捷键

- **Ctrl+Shift+Q**: 退出覆盖层或坐标显示器
- **控制面板**: 点击"退出控制面板"按钮或关闭窗口

## 注意事项

1. **坐标系统**：使用 macOS 屏幕坐标，左上角为 (0,0)
2. **窗口管理**：覆盖层设置为工具窗口，不显示在 Dock 中
3. **性能影响**：覆盖层对系统性能影响极小
4. **兼容性**：专为 macOS + Parallels + HEC-RAS 环境设计
5. **安全退出**：请使用快捷键安全退出，不要强制结束进程

## 故障排除

### 覆盖层不显示
- 确保 HEC-RAS 窗口在覆盖层下方
- 检查配置文件格式是否正确
- 确认 PySide6 已正确安装

### 鼠标穿透失效
- 重启覆盖层程序
- 确保窗口标志设置正确

### 坐标不准确
- 确保显示器分辨率设置正确
- 检查 macOS 显示缩放设置

## 技术实现

- **GUI框架**: PySide6 (Qt for Python)
- **命令行工具**: 基于 psutil 的进程管理
- **窗口特性**: 无边框、透明背景、始终置顶
- **鼠标穿透**: Qt.WindowTransparentForInput 标志
- **文件监听**: QFileSystemWatcher 实现热更新
- **坐标获取**: QCursor.pos() 获取全局鼠标位置
- **进程管理**: QProcess 和 psutil 控制子进程
- **状态监控**: 多线程实时监控程序运行状态

## 许可证

本项目仅供学习和个人使用，请遵守相关软件许可证协议。