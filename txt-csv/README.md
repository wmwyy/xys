# TXT到CSV转换工具 (PyQt6版本)

这是一个用于将地理测量数据从TXT格式转换为CSV格式的现代化工具，使用PyQt6构建美观的图形界面。

## 文件格式说明

### 输入TXT文件格式
```
;;;X(ƽ��m)  Y(�߳�m)
K0+042.55
0.000	1576.130
6.188	1568.140
15.374	1566.210
...
K0+092.04
0.000	1571.719
4.433	1566.520
...
```

- 第一行：标题行（程序会自动跳过）
- K开头行：里程桩号标记，如 `K0+042.55` 表示42.55米
- 数据行：制表符分隔的两个数字，分别表示距离和高度

### 输出CSV文件格式
```
A,B,D,C,Y
LZ,XSG,-42.55,0,1576.13
LZ,XSG,-42.55,6.188,1568.14
LZ,XSG,-42.55,15.374,1566.21
...
```

- 第一行：CSV标题行
- 后续行：`LZ,XSG,里程桩号负值,距离,高程`

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 图形界面版本（桌面应用程序）
运行主程序：
```bash
python3 txt_to_csv_converter.py
# 或者使用启动脚本
./start_converter.sh
```

界面功能：
1. 点击"添加TXT文件"选择要转换的文件（支持多选）
2. 选择输出目录（默认为当前目录）
3. 点击"开始转换"执行批量转换
4. 实时查看转换进度和日志
5. 支持取消正在进行的转换

### 命令行测试版本
```bash
python3 txt_to_csv_converter.py --test
```

## 版本对比

### PyQt6桌面版本
- 🎨 **现代化界面**: 基于PyQt6的美观用户界面
- 🔄 **多线程处理**: 转换过程在后台线程中运行，不阻塞界面
- ❌ **取消功能**: 支持取消正在进行的转换操作
- 📊 **实时进度**: 详细的进度条和状态显示
- 🎯 **智能编码检测**: 自动尝试多种编码格式（UTF-8、GBK、GB2312等）
- 📝 **丰富日志**: 详细的转换日志，包括成功和错误信息
- 🖥️ **菜单栏**: 提供文件和帮助菜单
- 💾 **直接写入**: 可直接写入本地文件系统

## 特性

- ✅ 支持批量转换多个TXT文件
- ✅ 自动检测和处理多种文件编码（UTF-8、GBK等）
- ✅ 图形界面友好，支持文件拖拽
- ✅ 实时进度显示和转换日志
- ✅ 错误处理和警告提示

## 示例文件

- `2026.1.13小砂沟上.txt` - 输入TXT文件示例
- `2026.1.13小砂沟.csv` - 对应的输出CSV文件示例
- `test_output_pyqt6.csv` - PyQt6版本测试输出

## 技术细节

- **GUI框架**: PyQt6 - 现代化的Python GUI框架
- **多线程**: 使用QThread进行后台转换，避免界面冻结
- **信号槽**: PyQt6信号槽机制处理线程间通信
- **里程桩号解析**: 正则表达式 `K(\d+)\+(\d+\.?\d*)` 提取公里数和米数
- **编码处理**: 自动尝试多种编码格式，确保兼容性
- **数据验证**: 对每行数据进行格式验证和错误处理

## 系统要求

- Python 3.7+
- PyQt6 6.4.0+
- 支持的操作系统：Windows、macOS、Linux

## 注意事项

1. 输入TXT文件必须包含里程桩号行（以K开头）
2. 数据行必须是制表符分隔的两个数值
3. 程序会自动跳过空行和无法解析的行
4. 输出文件会覆盖同名文件，请注意备份
5. 在转换过程中可以安全取消操作

## 更新日志

### v2.0 (PyQt6)
- 🔄 完全重写为PyQt6界面
- ➕ 添加多线程支持和取消功能
- 🎨 现代化UI设计和样式
- 📊 实时进度显示
- 🐛 改进编码检测和错误处理

### v1.0 (Tkinter)
- 基础的Tkinter界面版本
- 单线程转换处理

## Web版本详细说明

Web版本 (`index.html`) 是工具的纯前端实现，具有以下特点：

### 优势
- **无需安装**: 只需现代浏览器即可运行
- **跨平台兼容**: 支持Windows、macOS、Linux
- **安全性**: 在浏览器沙箱中运行，不访问本地文件
- **易于部署**: 可部署到任何Web服务器

### 功能特性
- 📁 **拖拽上传**: 支持拖拽多个TXT文件到上传区域
- 🔄 **批量转换**: 同时处理多个文件
- 📊 **实时进度**: 显示转换进度和状态
- 💾 **自动下载**: 转换完成后自动生成下载链接
- ⚙️ **配置选项**: 可自定义A列和B列的值
- 📋 **D列提取**: 支持提取去重D列数据

### 使用步骤
1. 启动Web服务器：`python3 -m http.server 8000`
2. 浏览器访问：`http://localhost:8000`
3. 上传TXT文件（拖拽或点击选择）
4. 配置参数（可选）
5. 点击"开始转换"
6. 下载生成的CSV文件

### 技术实现
- **前端技术**: HTML5、CSS3、ES6 JavaScript
- **文件API**: 使用FileReader读取文件内容
- **Blob API**: 生成文件并触发下载
- **响应式设计**: 支持桌面和移动设备

### 浏览器要求
- Chrome 70+
- Firefox 65+
- Safari 12+
- Edge 79+

### 限制
- 文件大小受浏览器内存限制
- 无法直接写入本地文件系统（通过下载方式解决）